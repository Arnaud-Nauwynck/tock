<!--
  ~ Copyright (C) 2017 VSCT
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~ http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~  Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->

<md-card class="sentence-analysis">
  <tock-highlight *ngIf="displayEntities" [sentence]="sentence"></tock-highlight>
  <md-card-content>
    <div class="sentence-analysis-content">
      <md-select class="intent"
                 placeholder="Intent"
                 [ngModel]="sentence.classification.intentId"
                 (change)="onIntentChange($event.value)">
        <md-option *ngFor="let intent of state.currentApplication.intents" [value]="intent._id">
          {{intent.name}}
        </md-option>
        <md-option value="newIntent">Create a new Intent</md-option>
      </md-select>

      <md-select placeholder="Language" [(ngModel)]="sentence.language" (change)="onLanguageChange($event.value)">
        <md-option *ngFor="let l of state.currentApplication.supportedLocales" [value]="l">
          {{state.localeName(l)}}
        </md-option>
      </md-select>
      <span *ngIf="displayProbabilities" class="probability">
        <span *ngIf="displayProbabilities && sentence.classification.intentId && sentence.classification.hasIntentProbability()"
              md-tooltip="intent probability">
           intent : {{sentence.classification.intentProbability | percent:'1.0-2'}}
        </span>
        <span *ngIf="displayProbabilities && displayEntities
        && sentence.classification.entities.length !== 0 && sentence.classification.hasEntitiesProbability()"
              md-tooltip="entities probability">
           , entities : {{sentence.classification.entitiesProbability | percent:'1.0-2'}}
        </span>
        <span *ngIf="displayProbabilities && sentence.classification.otherIntentsProbabilities?.size !== 0">
           <button *ngIf="!sentence.classification.displayOtherIntents"
                   (click)="sentence.classification.displayOtherIntents=true"
                   md-icon-button
                   md-tooltip="Display probability for other intents"><md-icon>expand_more</md-icon></button>
           <div *ngIf="sentence.classification.displayOtherIntents" class="otherIntents">
                  Probability for other intents:
                  <ol style="overflow:auto">
                    <li *ngFor="let i of sentence.classification.otherIntentsProbabilities | mapToIterable">
                      <div style="float:left">{{i.key}}&nbsp;&nbsp;</div><div style="float:right">&nbsp;{{i.value | percent:'1.0-2'}}</div>
                    </li>
                  </ol>
                  <button md-icon-button
                          (click)="sentence.classification.displayOtherIntents=false"
                          md-tooltip="Hide probabilities"><md-icon>expand_less</md-icon></button>
           </div>
        </span>
      </span>

      <md-list *ngIf="displayEntities">
        <md-list-item *ngFor="let entity of sentence.classification.entities">
          <label [style.background-color]="entity.entityColor">{{entity.qualifiedName(state.user)}}</label>
          &nbsp;&nbsp;&nbsp;{{sentence.entityValue(entity)}}
          <span *ngIf="displayProbabilities && entity.hasProbability()"
                class="probability"
                md-tooltip="Probability of entity recognition">
               {{entity.probability | percent:'1.0-2'}}
          </span>
          &nbsp;&nbsp;
          <button md-button color="warn" (click)="onDeleteEntity(entity)">
            <md-icon>delete</md-icon>
            Delete
          </button>
        </md-list-item>
      </md-list>
    </div>
  </md-card-content>
  <md-card-actions class="sentence-analysis-content">
      <button md-raised-button color="warn" (click)="onDelete()">Delete</button>
      <button md-raised-button color="accent" (click)="onArchive()" *ngIf="displayArchiveButton">Archive</button>
      <button md-raised-button color="primary" (click)="onValidate()">Validate</button>
      <button md-button *ngIf="config.displayDialogUrl"
              color="primary"
              (click)="displayDialogs()"
              md-tooltip="Display conversations using this sentence">Conversations</button>
  </md-card-actions>
</md-card>
